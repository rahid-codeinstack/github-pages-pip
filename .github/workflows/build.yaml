name: build Application
on:
     push:
          branches:
               - main
     workflow_dispatch:
permissions:
      contents: read      # to fetch repo code
      pages: write        # to deploy to GitHub Pages
      id-token: write     # required for OIDC authentication
jobs:
     test_code:
          runs-on: ubuntu-latest
          steps:
               - name: checkout repo
                 uses: actions/checkout@v3
               - name: setup node js enviroment
                 uses: actions/setup-node@v3
                 with:
                    node-version: 20
               - name: print node version
                 run: node -v 
               - name: cache dependencies
                 uses: actions/cache@v4
                 with:
                  path: ~/.npm
                  key: ${{runner.os}}-node-${{hashFiles('**/package-lock.json')}}
                  restore-keys: |
                   ${{ runner.os }}-node-
                   ${{ runner.os }}-
               - name: cache message
                 run: |
                  echo "cache successfully"
               - name: install dependencies
                 run: npm ci 
               - name: run test
                 run: npm run test 
               - name: print repo
                 run: |
                    echo '${{github.ref}}'
               - name: actions repository
                 run: echo '${{github.action_repository}}'
     build:
          runs-on: ubuntu-latest
          needs: test_code
          steps:
               - name: checkout repo
                 uses: actions/checkout@v3
               - name: setup node js enviroment
                 uses: actions/setup-node@v3
                 with:
                    node-version: 20
               - name: print node version
                 run: node -v 
               - name: cache dependencies
                 uses: actions/cache@v4
                 with:
                  path: ~/.npm
                  key: ${{runner.os}}-node-${{hashFiles('**/package-lock.json')}}
                  restore-keys: |
                   ${{ runner.os }}-node-
                   ${{ runner.os }}-
               - name: cache message
                 run: |
                  echo "cache successfully"
               - name: install dependencies
                 run: npm ci 
               - name: build apps
                 run: npm run build
               - name: print repo
                 run: |
                    echo '${{github.ref}}'
               - name: actions repository
                 run: echo '${{github.action_repository}}'
               - name: Archive production artifacts
                 uses: actions/upload-pages-artifact@v4
                 with:
                   name: github-pages
                   path: |
                      dist
                      !dist/**/*.md
     deploy:
          runs-on: ubuntu-latest
          environment:
            name: github-pages
            url: ${{ steps.deployment.outputs.page_url }}
          needs: build
          steps:
               - name: download aritifact 
                 uses: actions/download-pages-artifact@v5
                 with:
                  name: github-pages
                  path: dist
               - name: deploy to github pages
                 id: deployment
                 uses: actions/deploy-pages@v4
                 with:
                  token: ${{secrets.GITHUB_TOKEN}}


                   


             
             
          